machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - docker pull analogj/capsulecd
    - docker pull analogj/capsulecd:chef
    - docker pull analogj/capsulecd:javascript
    - docker pull analogj/capsulecd:node
    - docker pull analogj/capsulecd:python

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) docker run analogj/capsulecd bundle install --with test && rake 'spec:ruby' ;; 1) docker run analogj/capsulecd:chef bundle install --with test && rake 'spec:chef' ;; 2) docker run analogj/capsulecd:javascript bundle install --with test && rake 'spec:javascript' ;; 3) docker run analogj/capsulecd:node bundle install --with test && rake 'spec:node';; 4) docker run analogj/capsulecd:python bundle install --with test && rake 'spec:python' ;; esac:
      parallel: true

